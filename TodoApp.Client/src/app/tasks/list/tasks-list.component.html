<section class="flex h-full min-h-0 flex-col rounded-3xl border border-stroke bg-card p-4 shadow-card backdrop-blur">
  <div class="flex items-center justify-between">
    <h2 class="text-xl font-semibold text-ink-900">Tasks</h2>
    <div class="flex items-center gap-3">
      <div class="flex rounded-full border border-stroke bg-white p-1">
        <button
          type="button"
          class="rounded-full px-3 py-1.5 text-sm font-semibold transition"
          [class.bg-ink-900]="filtersForm.value.status === 'all'"
          [class.text-white]="filtersForm.value.status === 'all'"
          (click)="statusChange.emit('all')"
        >
          All
        </button>

        <button
          type="button"
          class="rounded-full px-3 py-1.5 text-sm font-semibold transition"
          [class.bg-ink-900]="filtersForm.value.status === 'open'"
          [class.text-white]="filtersForm.value.status === 'open'"
          (click)="statusChange.emit('open')"
        >
          Active
        </button>

        <button
          type="button"
          class="rounded-full px-3 py-1.5 text-sm font-semibold transition"
          [class.bg-ink-900]="filtersForm.value.status === 'done'"
          [class.text-white]="filtersForm.value.status === 'done'"
          (click)="statusChange.emit('done')"
        >
          Completed
        </button>
      </div>

      <app-button
        variant="primary"
        size="md"
        (click)="createTask.emit()"
      >
        New task
      </app-button>
    </div>
  </div>

  <div class="mt-4">
    <form class="grid gap-3" [formGroup]="filtersForm" (ngSubmit)="$event.preventDefault()">
      <app-input
        [control]="filtersForm.controls['search']"
        placeholder="Search tasks..."
        size="sm"
      />
    </form>
  </div>

  <div class="mt-4 flex-1 min-h-0 overflow-y-auto pr-1">
    @if (loading) {
      <div class="rounded-2xl border border-stroke bg-card p-4 text-sm text-ink-500 shadow-sm">
        Loading tasks...
      </div>
    } @else if (!tasks?.items?.length) {
      <div class="rounded-2xl border border-stroke bg-card p-4 text-sm text-ink-500 shadow-sm">
        No tasks yet. Create one to get started.
      </div>
    } @else {
      <div class="space-y-3 pb-2">
        @for (task of tasks?.items ?? []; track task.id) {
          <article
            class="cursor-pointer rounded-2xl border border-stroke bg-card p-3 shadow-sm transition hover:border-mint-500/50 hover:bg-slate-50"
            [class.border-mint-500]="task.id === selectedTaskId"
            (click)="selectTask.emit(task.id)"
          >
            <div class="flex items-center justify-between gap-3">
              <div class="flex items-center gap-3">
                <button
                  class="flex h-9 w-9 items-center justify-center rounded-full border border-stroke text-ink-700 transition hover:border-mint-500 hover:text-mint-600"
                  type="button"
                  (click)="toggleComplete.emit(task); $event.stopPropagation()"
                >
                  @if (task.isCompleted) {
                    ✓
                  } @else {
                    ○
                  }
                </button>

                <div class="space-y-1">
                  <div class="flex flex-wrap items-center gap-2">
                    <h3 class="text-base font-semibold text-ink-900" [class.line-through]="task.isCompleted">
                      {{ task.title }}
                    </h3>
                    <span class="text-xs text-ink-500">
                      {{ task.categoryName ?? 'No category' }}
                    </span>
                  </div>
                  <p class="text-xs text-ink-500">
                    Created: {{ task.createdAt | date:'medium' }}
                  </p>
                </div>
              </div>

              <span
                class="rounded-full px-3 py-1 text-xs font-semibold"
                [ngClass]="task.isCompleted ? 'bg-mint-500/10 text-mint-600' : 'bg-amber-50 text-amber-700'"
              >
                {{ task.isCompleted ? 'Completed' : 'Active' }}
              </span>
            </div>
          </article>
        }
      </div>
    }
  </div>
  <div class="border-t border-stroke bg-surface pt-2 shadow-panel">
    <app-pagination
      [page]="tasks?.page ?? 1"
      [totalPages]="tasks?.totalPages ?? 1"
      [loading]="loading"
      (prev)="pageChange.emit('prev')"
      (next)="pageChange.emit('next')"
    />
  </div>
</section>
